<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-08-28 Mon 19:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Go Recipes - Gosh Tips</title>
<meta name="author" content="Nick Wells" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/readtheorg.css"/>
<script type="text/javascript" src="src/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="src/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Go Recipes - Gosh Tips</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd144254">Gosh Tips</a>
<ul>
<li><a href="#org4ff8014">Installing gosh</a>
<ul>
<li><a href="#org51f8d03">Summary</a></li>
<li><a href="#orga085cf3">Discussion</a></li>
</ul>
</li>
<li><a href="#org9f2f7b4">Getting help</a></li>
<li><a href="#orgae07031">Running code</a>
<ul>
<li><a href="#org24ea872">Summary</a></li>
<li><a href="#orge634b78">Discussion</a></li>
</ul>
</li>
<li><a href="#org13d47bc">Code sections</a>
<ul>
<li><a href="#orga3b1a12">Summary</a></li>
</ul>
</li>
<li><a href="#org8909448">Shortcuts for printing</a>
<ul>
<li><a href="#org5bb8edf">Summary</a></li>
</ul>
</li>
<li><a href="#org346fb38">Snippets</a>
<ul>
<li><a href="#org1969c33">Summary</a></li>
</ul>
</li>
<li><a href="#org1fe75af">Looping over input</a>
<ul>
<li><a href="#org09a5726">Summary</a></li>
</ul>
</li>
<li><a href="#orgbe3770e">Missing goimports command</a>
<ul>
<li><a href="#org2bff1a2">Summary</a></li>
<li><a href="#orgca669ad">Discussion</a></li>
</ul>
</li>
<li><a href="#orgc267b45">goimports isn't finding my package</a>
<ul>
<li><a href="#orgc664297">Summary</a></li>
</ul>
</li>
<li><a href="#org046c56a">Troubleshooting the generated program</a>
<ul>
<li><a href="#org96d89a2">Summary</a></li>
</ul>
</li>
<li><a href="#org36d62ed">What is gosh doing</a>
<ul>
<li><a href="#org00e5981">Summary</a></li>
</ul>
</li>
<li><a href="#org03f5d6a">Useful shell aliases</a>
<ul>
<li><a href="#org17d9388">Summary</a></li>
</ul>
</li>
<li><a href="#org7a72a57">Using gosh in shebang scripts</a>
<ul>
<li><a href="#org91101c7">Summary</a></li>
<li><a href="#org555c662">Discussion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgd144254" class="outline-2">
<h2 id="orgd144254">Gosh Tips</h2>
<div class="outline-text-2" id="text-orgd144254">
<p>
These recipes offer some tips for getting the most from gosh and how to fix
any problems you might have.
</p>

<p>
This uses the <a href="https://pkg.go.dev/github.com/nickwells/param.mod/v5/param">param</a> package for handling parameters; <a href="pkg-param.html">see here</a> for notes on
features such as help messages offered through the param package.
</p>

<p>
For other recipes <a href="gorecipes.html">see here</a>.
</p>
</div>
<div id="outline-container-org4ff8014" class="outline-3">
<h3 id="org4ff8014">Installing gosh</h3>
<div class="outline-text-3" id="text-org4ff8014">
</div>
<div id="outline-container-org51f8d03" class="outline-4">
<h4 id="org51f8d03">Summary</h4>
<div class="outline-text-4" id="text-org51f8d03">
<p>
To install gosh run the following command:
</p>

<div class="org-src-container">
<pre class="src src-sh">go install github.com/nickwells/utilities/gosh@latest
</pre>
</div>

<p>
This will install the gosh command in the $GOPATH/bin directory (by
default: $HOME/go/bin). Make sure you have that directory added to your
PATH.
</p>
</div>
</div>

<div id="outline-container-orga085cf3" class="outline-4">
<h4 id="orga085cf3">Discussion</h4>
<div class="outline-text-4" id="text-orga085cf3">
<p>
The gosh command is self contained but there are some extras which
you can also install.
</p>

<p>
You can use the newly installed gosh command to check that it has
everything it needs as follows:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -pre-check
</pre>
</div>

<p>
This will not generate a program but will instead check that the commands
that gosh needs are available and recommends any fixes.
</p>

<p>
One thing that the pre-check might warn about is if you haven't installed
snippets (pre-written code fragments). These are not strictly necessary,
you can run gosh without them, but they can be useful.
</p>

<p>
To install the snippets you will need to choose where you want to copy
them. Gosh comes with some standard directories which it will search for
snippets, the following command will list them:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -snippet-list-dir
</pre>
</div>

<p>
Choose one of these directories and set the SD shell variable to the
directory name (this is just for the purpose of the installation commands
below).
</p>

<p>
The recommended way of installing the snippets is to install the
gosh.snippet command and then use that to install the standard
snippets. The following command will create the snippet directory if it
doesn't already exist and will copy in the standard set of snippets,
moving aside any differing snippets of the same name.
</p>

<div class="org-src-container">
<pre class="src src-sh">go install github.com/nickwells/utilities/gosh.snippet@latest
gosh.snippet -to $SD -install
</pre>
</div>

<p>
If you run it without the install parameter it will just compare the
standard snippet set with the contents of the directory you have
given. If you are installing the snippets for the first time then it
should report them as all being new.
</p>

<p>
Alternatively you can copy the snippets directly. If you git clone the
utilities repository you can find the _snippets directory under the
gosh.snippet directory. The following commands (on Linux) will create
the snippets directory and copy in the standard snippets, when run from
the gosh.snippet source directory.
</p>

<div class="org-src-container">
<pre class="src src-sh">mkdir --parents $SD
cp -r --suffix=.orig --backup ./_snippets/* $SD
</pre>
</div>

<p>
Once you have installed the snippets, using either of the methods above,
you should clear out any copies generated of snippets you may have set up
before. You only need to do this if you already had older versions of the
snippets in target directory. A useful command for helping with this is
the findCmpRm command which can be installed as follows.
</p>

<div class="org-src-container">
<pre class="src src-sh">go install github.com/nickwells/utilities/findCmpRm@latest
findCmpRm -dir $SD -recursive -extension .orig
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9f2f7b4" class="outline-3">
<h3 id="org9f2f7b4">Getting help</h3>
<div class="outline-text-3" id="text-org9f2f7b4">
<p>
Comprehensive help is available by simply passing the help parameter as
follows:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -help
</pre>
</div>

<p>
<a href="pkg-param.html">See here</a> for more details.
</p>
</div>
</div>

<div id="outline-container-orgae07031" class="outline-3">
<h3 id="orgae07031">Running code</h3>
<div class="outline-text-3" id="text-orgae07031">
</div>
<div id="outline-container-org24ea872" class="outline-4">
<h4 id="org24ea872">Summary</h4>
<div class="outline-text-4" id="text-org24ea872">
<p>
The 'exec' parameter (or its synonym 'e') gives code for gosh to run.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -e 'fmt.Println("Hi!")'
</pre>
</div>

<p>
This will print "Hi!".
</p>
</div>
</div>

<div id="outline-container-orge634b78" class="outline-4">
<h4 id="orge634b78">Discussion</h4>
<div class="outline-text-4" id="text-orge634b78">
<p>
You can have multiple lines of code by repeating the exec parameter; they
are added in the order they appear on the command line. Alternatively you
can have multiple lines in the same parameter; make sure that you've
quoted it correctly so the shell doesn't think you've finished the
command early. You can separate Go statements with semi-colons either;
these are not normally needed by Go and the gofmt (or goimports) command
will replace them with new lines but it can make it easier when entering
Go code at the command line. The following are all equivalent:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -e 'fmt.Print("Greetings,")' -e 'fmt.Println(" Universe!")'
gosh -e 'fmt.Print("Greetings,"); fmt.Println(" Universe!")'
gosh -e 'fmt.Print("Greetings,")
fmt.Println(" Universe!")'
</pre>
</div>

<p>
Code given to gosh through the 'exec' parameter will appear in the 'main'
function. If you want to declare a function you will need to add it to
the global scope using the 'global' (or 'g') parameter. The following
code declares a function that prints "Hello, World!" and then calls it.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -g 'func F() { fmt.Print("Hello, World!\n") }' -e 'F()'
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org13d47bc" class="outline-3">
<h3 id="org13d47bc">Code sections</h3>
<div class="outline-text-3" id="text-org13d47bc">
</div>
<div id="outline-container-orga3b1a12" class="outline-4">
<h4 id="orga3b1a12">Summary</h4>
<div class="outline-text-4" id="text-orga3b1a12">
<p>
When gosh builds the code to be run it builds it in sections. There are
the boilerplate sections that gosh generates itself and there are
sections that gosh populates with code that you have given. The code
sections are listed in a help note; run the following code to see this
note.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -help-note 'Gosh - code sections'
</pre>
</div>

<p>
The sections are each separate and you can populate them
independently. Code added to a section is added in the order it appears
on the command line. For instance:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -after 'fmt.Print("a1")' \
     -exec 'fmt.Print("e1")' \
     -before 'fmt.Print("b1")' \
     -after 'fmt.Print("a2")' \
     -exec 'fmt.Print("e2")' \
     -before 'fmt.Print("b2")'
</pre>
</div>

<p>
will print "b1b2e1e2a1a2" so you can see that the sections are grouped
independently. Code in the 'global' section is for global variables and
functions, it will appear outside the main function.
</p>

<p>
The different sections are present because gosh can run code in a loop
where it reads from standard input (or files) a line at a time and then
the code in the 'before' section appears before the loop, the 'after'
section comes after the loop and the 'exec' section runs inside the loop.
</p>
</div>
</div>
</div>

<div id="outline-container-org8909448" class="outline-3">
<h3 id="org8909448">Shortcuts for printing</h3>
<div class="outline-text-3" id="text-org8909448">
</div>
<div id="outline-container-org5bb8edf" class="outline-4">
<h4 id="org5bb8edf">Summary</h4>
<div class="outline-text-4" id="text-org5bb8edf">
<p>
There are some shortcuts that gosh offers to make it faster and easier to
write scripts. Printing is a common task and gosh offers some parameters
to make this simpler. The following are equivalent:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -pln '"Hi!"'
gosh -e 'fmt.Println("Hi!")'
</pre>
</div>
<p>
&#x2026; and &#x2026;
</p>
<div class="org-src-container">
<pre class="src src-sh">gosh -pf '"pi = %.9f\n", math.Pi'
gosh -e 'fmt.Printf("pi = %.9f\n", math.Pi)'
</pre>
</div>

<p>
There are similar shortcuts for printing in the various code sections;
see the help message for details.
</p>
</div>
</div>
</div>

<div id="outline-container-org346fb38" class="outline-3">
<h3 id="org346fb38">Snippets</h3>
<div class="outline-text-3" id="text-org346fb38">
</div>
<div id="outline-container-org1969c33" class="outline-4">
<h4 id="org1969c33">Summary</h4>
<div class="outline-text-4" id="text-org1969c33">
<p>
gosh allows you to have useful code fragments called snippets in files
and to import them into the program being built. These can either be
given as complete filenames or, more usefully, as shorter names in
standard directories. To see all the snippets available pass the
snippet-list parameter as follows:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -snippet-list
</pre>
</div>

<p>
You can write your own snippets, just create a file containing Go code
into one of the snippet directories and you can start using it. It's
worth adding some documentary comments as well though if only so you'll
remember what it was for. The standard snippets are all documented and
use the meaningful comment tags to help gosh check that snippets are
being used correctly.
</p>

<p>
When writing a snippet it is worth following the convention of starting
the names of any variables you create with a double underscore. This will
mean you are unlikely to clash with the names of any variables that
you'll use in your gosh scripts and it also avoids clashing with
variables that gosh itself creates (these all start with a single
underscore).
</p>

<p>
To see the gosh notes on snippets the following gosh command will show
you just what you need.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -help-notes 'Gosh - snippets,Gosh - snippet comments,Gosh - snippet directories'
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1fe75af" class="outline-3">
<h3 id="org1fe75af">Looping over input</h3>
<div class="outline-text-3" id="text-org1fe75af">
</div>
<div id="outline-container-org09a5726" class="outline-4">
<h4 id="org09a5726">Summary</h4>
<div class="outline-text-4" id="text-org09a5726">
<p>
A common task at the command line is to read the standard output of a
previous command, do something with it and write the transformed input
onto the standard output. In Unix terminology such programs are called
filters. Gosh offers some parameters to help write filters in Go at the
command line.
</p>

<p>
The 'run-in-readloop' parameter (or 'n' for short) will use a
bufio.Scanner called '_l' to read from standard input (by default)
and the lines (with any newline removed) are then available to you using
the 'Text' method on the scanner.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -n -b 'count := 0' -e 'count++' -a-pln count
</pre>
</div>

<p>
This will count the lines like the Linux 'wc' command.    
</p>

<p>
If you want to split the line into parts run gosh passing the
'split-line' (or 's') parameter. The default behaviour splits the line
into words separated by one or more whitespace characters. You can change
the regular expression used to split the line by passing the
'split-pattern' (or 'sp') parameter. The parts are written into a slice
of strings called '_lp'.
</p>

<p>
If you want to run the script over a list of files instead of over the
standard input these files can be provided after the '&#x2013;' parameter. In
this case the script will loop over each file in turn. In this case the
before-inner and after-inner code sections become useful as you can use
them to insert code af=round the inner loop.
</p>
</div>
</div>
</div>

<div id="outline-container-orgbe3770e" class="outline-3">
<h3 id="orgbe3770e">Missing goimports command</h3>
<div class="outline-text-3" id="text-orgbe3770e">
</div>
<div id="outline-container-org2bff1a2" class="outline-4">
<h4 id="org2bff1a2">Summary</h4>
<div class="outline-text-4" id="text-org2bff1a2">
<p>
If you have goimports properly installed on your machine then gosh will
run it to format the program before running it. This will add any import
statements you need.
</p>

<p>
There can be a number of problems:
</p>
<ul class="org-ul">
<li>goimports is not installed</li>
<li>it is installed but it isn't in any directory in the PATH</li>
<li>it's deliberately not installed</li>
</ul>

<p>
If it isn't installed then you can install it by following the
instructions at <a href="https://pkg.go.dev/golang.org/x/tools/cmd/goimports">golang.org/x/tools/cmd/goimports</a>.
</p>

<p>
If it is not in your PATH then you can tell gosh the
formatter to use as follows:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -e 'fmt.Print("Hello,")
     fmt.Println(" World!")' -formatter /home/me/go/bin/goimports
</pre>
</div>

<p>
If it's not installed and you don't want to install it
then you will need to give all the imports explicitly.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -e 'var v rune; fmt.Println(unsafe.Sizeof(v))' -import unsafe -import fmt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca669ad" class="outline-4">
<h4 id="orgca669ad">Discussion</h4>
<div class="outline-text-4" id="text-orgca669ad">
<p>
The goimports program is a very useful tool - it will format your program
just like gofmt but it will also find any packages that haven't been
imported and it will add import statements for them. It can sometimes
pick the wrong version of a module and so you might want to provide the
package import explicitly even if it is available.
</p>

<p>
If goimports isn't available for some reason, you can use the gopls
program as an alternative as follows:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -e 'fmt.Println("Hello")' -formatter gopls -formatter-args="imports","-w"
</pre>
</div>

<p>
The formatter and formatter-args parameters can be added to the gosh
config file so that they don't need to be repeated every time. To
find the config file for gosh, you can run it as follows:
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -help-show sources
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc267b45" class="outline-3">
<h3 id="orgc267b45">goimports isn't finding my package</h3>
<div class="outline-text-3" id="text-orgc267b45">
</div>
<div id="outline-container-orgc664297" class="outline-4">
<h4 id="orgc664297">Summary</h4>
<div class="outline-text-4" id="text-orgc664297">
<p>
You have goimports installed and you've called some function from the
package but goimports isn't finding it; what's the problem?
</p>

<p>
The first thing to check is that you've got the function name correct and
the right arguments, that's a common reason for failing to import the
right package.
</p>

<p>
Another reason, if the package has just been uploaded, is that the Go
proxy might not have been updated yet. You can either wait a few minutes
or else import the package by hand through the -import (or -I) parameter.
</p>
</div>
</div>
</div>

<div id="outline-container-org046c56a" class="outline-3">
<h3 id="org046c56a">Troubleshooting the generated program</h3>
<div class="outline-text-3" id="text-org046c56a">
</div>
<div id="outline-container-org96d89a2" class="outline-4">
<h4 id="org96d89a2">Summary</h4>
<div class="outline-text-4" id="text-org96d89a2">
<p>
If the code you supply doesn't behave as you think it should you can
always examine the generated program. If there is an error while running
the program or it can't be run at all then it will show the name
of the directory where gosh built your program. This will not have been
cleared up as usual and so you can take a look at the generated
code. Alternatively you can run gosh with the show-filename parameter.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -pln '"Hello World!"' -show-filename
</pre>
</div>

<p>
This will run the program as normal but will report the directory and
file names and will not clear the directory when it finishes so you can
examine the code.
</p>

<p>
When looking at the code it might be useful to have gosh provide comments
which will make it clearer which lines are written by gosh and which you
have supplied. The add-comments parameter makes gosh comment the code.
</p>

<p>
Alternatively, you can run gosh with the edit parameter and it will open
the gosh-generated program in your favourite editor (as given by the EDITOR
environment variable) just before running
it and you can correct any problems or just take a look at what gets
generated.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -pln '"Hello World!"' -edit
</pre>
</div>

<p>
You can also make gosh loop around the edit/build/run steps until you are
happy with the result. To achieve this call gosh with the edit-repeat
parameter.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -pln '"Hello World!"' -edit-repeat
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org36d62ed" class="outline-3">
<h3 id="org36d62ed">What is gosh doing</h3>
<div class="outline-text-3" id="text-org36d62ed">
</div>
<div id="outline-container-org00e5981" class="outline-4">
<h4 id="org00e5981">Summary</h4>
<div class="outline-text-4" id="text-org00e5981">
<p>
If you run gosh as usual but add a "-verbose" parameter it will run the
program but it will also print out messages explaining the steps it is
taking and some timing information.
</p>

<div class="org-src-container">
<pre class="src src-sh">gosh -pln '"Hello, World!"' -verbose
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org03f5d6a" class="outline-3">
<h3 id="org03f5d6a">Useful shell aliases</h3>
<div class="outline-text-3" id="text-org03f5d6a">
</div>
<div id="outline-container-org17d9388" class="outline-4">
<h4 id="org17d9388">Summary</h4>
<div class="outline-text-4" id="text-org17d9388">
<p>
Your shell may offer an alias feature so that you can access commands
more quickly, here are a few suggestions for some aliases that speed up
common gosh tasks. These work in zsh and bash at least. You might need to
change the alias names if they clash with any existing aliases. Note that
the aliases use the long parameter names for documentation purposes; the
following comments give an equivalent short-form.
</p>

<div class="org-src-container">
<pre class="src src-sh">alias g.e="gosh -exec"		# -e
alias g.es="gosh -exec-snippet"	# -e-s
alias g.p="gosh -println"		# -pln
alias g.pf="gosh -printf"		# -pf
alias g.h="gosh -help"		# -help
alias g.has="gosh -help-all-short"	# -help-as
alias g.hf="gosh -help-full"		# -help-f
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7a72a57" class="outline-3">
<h3 id="org7a72a57">Using gosh in shebang scripts</h3>
<div class="outline-text-3" id="text-org7a72a57">
<p>
gosh can be used as the interpreter for shebang scripts, that is
executable text files with the first line starting '#!'.
</p>
</div>
<div id="outline-container-org91101c7" class="outline-4">
<h4 id="org91101c7">Summary</h4>
<div class="outline-text-4" id="text-org91101c7">
<p>
You can write Go code in a file and put:
</p>

<div class="org-src-container">
<pre class="src src-sh">#!gosh -shebang
</pre>
</div>

<p>
at the very top of the file and gosh will read the rest of the file as a
script to be built into a main func and run it.
</p>
</div>
</div>

<div id="outline-container-org555c662" class="outline-4">
<h4 id="org555c662">Discussion</h4>
<div class="outline-text-4" id="text-org555c662">
<p>
Although the code above shows just the command name, it is safest to put
the whole path to gosh as the interpreter name. Be aware that this might
make the script less portable to other hosts where the path to gosh is
different.
</p>

<p>
The way to pass gosh params to a shebang script is through comments at
the start of the script. Any line immediately following the '#!' line
which starts with '#' will be stripped from the code to be compiled. If
the line starts '#gosh.param:' then the remainder of the line is treated
like a line in a parameter file.
</p>

<p>
The most robust way of writing a shebang script using gosh is to add
comment lines at the front controlling how it works. Some suggested
parameters are:
</p>
<dl class="org-dl">
<dt>import</dt><dd>to give the packages to import</dd>
<dt>no-auto-import</dt><dd>to speed up execution and remove dependency on other tools</dd>
<dt>no-go-mod-tidy</dt><dd>to speed up execution and remove dependency on other tools</dd>
<dt>set-go-cmd</dt><dd>to let users without Go in their path to run the script</dd>
<dt>set-executable-name</dt><dd>to make it easier to find the command in ps listings</dd>
<dt>show-filename=false</dt><dd>to undo the effect of the set-executable-name</dd>
<dt>dont-loop-on-args</dt><dd>to stop gosh from looping over the arguments</dd>
<dt>no-more-params</dt><dd>to prevent any arguments to the script being passed to gosh</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Nick Wells</p>
<p class="date">Created: 2023-08-28 Mon 19:43</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>